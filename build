#!/bin/bash

# the list of input files 
filenameList=(
  'XMPP_Federado.rst'
  'borrador.rst'
  'draft_en.rst'
)

# the output directory 
buildFolder='../proposal-build'

function makePdf {

  inputLang='es'
  inputRst=$1
  outputTex=$buildFolder/$(basename "${inputRst/.rst}").tex

  if [[ $inputRst =~ \_([a-z][a-z])\. ]]; then
    inputLang=${BASH_REMATCH[1]}
    echo 'found language '$inputLang
  fi

  echo 'input: '$inputRst' output: '$outputTex

  rst2xetex --template=latex2e/xelatex.tex \
            --documentclass=article \
            --documentoptions=letterpaper,11pt \
            --use-latex-docinfo \
            --section-subtitles \
            --smart-quotes=yes \
            -g \
            -l $inputLang \
            $inputRst \
            $outputTex

  sed -i '/^Generated by \\href{/d' $outputTex
  latexmk -silent -xelatex -output-directory=$buildFolder $outputTex

}

if [[ $1 ]]; then
  buildFolder=$1
fi

if [ -d "$buildFolder" ]; then
  for i in ${filenameList[@]};do
    makePdf $i
  done
else
  echo 'cannot access '$1': No such file or directory'
fi


#!/bin/bash

# the list of input files 
filenameList=(
  'XMPP_Federado'
  'borrador'
  'draft_en'
)

# the output directory 
buildFolder='../proposal-build'

function makePdfs {
  for i in ${filenameList[@]};do

    inputRst=$i.rst
    outputTex=$buildFolder/"$i".tex

    echo 'input: '$inputRst' output: '$outputTex

    rst2xetex --template=latex2e/xelatex.tex \
              --documentclass=article \
              --documentoptions=letterpaper,11pt \
              --use-latex-docinfo \
              --section-subtitles \
              --smart-quotes=yes \
              -g \
              -l es \
              $inputRst \
              $outputTex

    sed -i '/^Generated by \\href{/d' $outputTex
    latexmk -xelatex -output-directory=$buildFolder $outputTex
  done

}

if [[ $1 ]]; then
  buildFolder=$1
fi

if [ -d "$buildFolder" ]; then
  makePdfs
else
  echo 'cannot access '$1': No such file or directory'
fi

